local player = game:GetService("Players").LocalPlayer
local gui = player:WaitForChild("PlayerGui")

-- Удаляем старый GUI если есть
if gui:FindFirstChild("MobileControls") then
    gui.MobileControls:Destroy()
end

-- Создаем основной интерфейс
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MobileControls"
screenGui.ResetOnSpawn = false
screenGui.Parent = gui

-- Стиль для кнопок
local buttonStyle = {
    Size = UDim2.new(0, 80, 0, 80),
    BackgroundTransparency = 0.3,
    TextColor3 = Color3.new(1, 1, 1),
    TextSize = 16,
    AnchorPoint = Vector2.new(0.5, 0.5),
    ZIndex = 10,
    AutoButtonColor = false
}

-- Создаем кнопки с разными цветами
local tackleBtn = Instance.new("TextButton")
tackleBtn.Name = "BUGTACKLE"
tackleBtn.Text = "BUGTACKLE"
tackleBtn.BackgroundColor3 = Color3.fromRGB(0, 102, 255) -- Синий цвет
tackleBtn.Position = UDim2.new(0.2, 0, 0.8, 0)
tackleBtn.Parent = screenGui

local teleportBtn = Instance.new("TextButton")
teleportBtn.Name = "TELEPORT"
teleportBtn.Text = "TELEPORT"
teleportBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60) -- Красный цвет как на фото
teleportBtn.Position = UDim2.new(0.4, 0, 0.8, 0)
teleportBtn.Parent = screenGui

-- Применяем общий стиль к кнопкам
for _, btn in pairs({tackleBtn, teleportBtn}) do
    for prop, value in pairs(buttonStyle) do
        if prop ~= "BackgroundColor3" then -- Не перезаписываем цвет
            btn[prop] = value
        end
    end
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = btn
    
    -- Эффект нажатия
    btn.MouseButton1Down:Connect(function()
        btn.BackgroundTransparency = 0.6
    end)
    
    btn.MouseButton1Up:Connect(function()
        btn.BackgroundTransparency = 0.3
    end)
end

-- Функция Tackle
local function doTackle()
    local target = workspace:FindFirstChild("Ball") or workspace:FindFirstChildOfClass("BasePart")
    local remotePaths = {game:GetService("ReplicatedStorage"), player.PlayerGui, player.Character}
    
    for _, location in pairs(remotePaths) do
        if location then
            for _, remote in pairs(location:GetDescendants()) do
                if remote:IsA("RemoteEvent") and (remote.Name:find("Tackle") or remote.Name:find("Hitbox")) then
                    pcall(remote.FireServer, remote, target)
                end
            end
        end
    end
end

-- Функция телепорта с учетом команды
local function doTeleport()
    pcall(function()
        local character = player.Character
        if not character then return end
        
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        
        local team = player.Team and player.Team.Name or "Default"
        local targetPosition = team == "Red" and Vector3.new(-2263.6, -25.5, 1029.0)
                          or team == "Blue" and Vector3.new(-2839.7, -25.5, 1029.6)
                          or Vector3.new(-2238.1218, -25.3756, 1050.0332)
        
        hrp.CFrame = CFrame.new(targetPosition)
    end)
end

-- Привязываем функции
tackleBtn.MouseButton1Click:Connect(doTackle)
teleportBtn.MouseButton1Click:Connect(doTeleport)

-- Система перемещения кнопок
local function makeDraggable(btn)
    local dragging, dragInput, dragStart, startPos
    
    btn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = btn.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    btn.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            btn.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

makeDraggable(tackleBtn)
makeDraggable(teleportBtn)
